version: 0.2

env:
  shell: bash
  variables:
    DEPLOYMENT_NAME: roman
    ENVIRONMENT: sandbox
    USE_FLOATING: 0
    IMAGE_TAG: latest
    COMMON_TAG: common-latest
    ACCOUNT_ID: xxxxxx
    ADMIN_ROLE: yyyyyyyyyyy

#   secrets-manager:
#     key: secret-id:json-key:version-stage:version-id
#   git-credential-helper: no | yes

# proxy:
#   upload-artifacts: no | yes
#   logs: no | yes

# batch:
#   fast-fail: false | true
#   # build-list:
#   # build-matrix:
#   # build-graph:

phases:
  install:
    runtime-versions:
      docker: 19
    commands:
      - echo ---------------------------------------------------------------
      - echo Installing miniconda...
      - wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
      - chmod +x Miniconda3-latest-Linux-x86_64.sh
      - ./Miniconda3-latest-Linux-x86_64.sh -b -p ~/python
      - ~/python/bin/conda   init
      - source ~/.bashrc
      - echo ---------------------------------------------------------------
      - echo Installing pip requirements...
      - pip install -r requirements.txt
      - echo ---------------------------------------------------------------
      - echo Sourcing environment files...
      - source stable-env
      - source derived-env
  build:
    commands:
      - image-build
  post_build:
    commands:
      - image-test
      # - image-push
      # - image-scan
